<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body style="margin: 0;position: absolute;width: 100%;height: 100%;" id="body">
<div style="height: 33%" id="div1"></div>
<div style="height: 33%" id="div2"></div>
<div style="height: 33%" id="div3"></div>
<!--<div class="carousel">-->
<!--<main class="main">-->
<!--<div class="previous">-->
<!--<div class="previous-button"></div>-->
<!--</div>-->
<!--<div class="img-wrapper left" id="img-wrapper1">-->
<!--<img>-->
<!--</div>-->
<!--<div class="img-wrapper current" id="img-wrapper2">-->
<!--<img>-->
<!--</div>-->
<!--<div class="img-wrapper right" id="img-wrapper3">-->
<!--<img>-->
<!--</div>-->
<!--<div class="next">-->
<!--<div class="next-button"></div>-->
<!--</div>-->
<!--<div class="guide">-->
<!--</div>-->
<!--</main>-->
<!--</div>-->
</body>
</html>
<style scoped>
    .carousel {
        height: 100%;
    }

    .main {
        font-size: 0;
        white-space: nowrap;
        height: 100%;
        position: relative;
        overflow: hidden;
    }

    .img-wrapper {
        display: inline-block;
        width: 100%;
        height: 100%;
        position: absolute;
        transition: left .5s;
    }

    .img-wrapper img {
        height: 100%;
        width: 100%;
    }

    main:hover .previous {
        visibility: visible;
    }

    main:hover .next {
        visibility: visible;
    }

    .previous {
        z-index: 3;
        cursor: pointer;
        left: 1%;
        top: 0;
        bottom: 0;
        margin: auto;
        position: absolute;
        width: 33px;
        height: 33px;
        border-radius: 50%;
        border: 1px solid grey;
        visibility: hidden;
    }

    .next {
        z-index: 3;
        cursor: pointer;
        right: 1%;
        top: 0;
        bottom: 0;
        margin: auto;
        position: absolute;
        width: 33px;
        height: 33px;
        border-radius: 50%;
        border: 1px solid grey;
        visibility: hidden;
    }

    .previous-button {
        position: absolute;
        height: 0;
        top: 0;
        left: 7px;
        bottom: 0;
        margin: auto 0;
        border-top: 8px solid transparent;
        border-right: 15px solid #c5c5c5;
        border-bottom: 8px solid transparent;
    }

    .next-button {
        position: absolute;
        height: 0;
        top: 0;
        left: 11px;
        bottom: 0;
        margin: auto 0;
        border-top: 8px solid transparent;
        border-left: 15px solid #c5c5c5;
        border-bottom: 8px solid transparent;
    }

    .left {
        left: -100%;
    }

    .current {
        left: 0;
    }

    .right {
        left: 100%;
    }

    .guide {
        position: absolute;
        bottom: 5%;
        left: 50%;
        transform: translateX(-50%); /*自身宽度的50%*/
    }

    .indicator {
        width: 11px;
        height: 11px;
        border-radius: 50%;
        background: #eeeeee;
        border: 1px solid white;
        cursor: pointer;
        display: inline-block;
        margin: 0 11px;
    }

    .indicator:hover {
        border-color: #328bff;
    }
</style>
<script>
var carousel = (function () {
  function noop () {
  }

  function initCarousel (options) {
    var urls = []
    var LEFT = 0, RIGHT = 1;
    var boxes = [];
    var curIndex = 0;
    var isAutoPlay = true;
    var cycle = 2222//ms
    var isMoving = false;//全局状态控制
    var timerId = null;
    var changeCallback = null;
    init(options);

    /*
     * {
     *   el:
     *   urls:[]
     *   curIndex:0
     *   isAutoPlay:true
     *   cycle:999
     *   change:function
     * }
     * */
    function init (options) {
      if (!options.el) {
        throw new Error('el does not exist');
      }
      initData(options);
      initDom(options);
      boxes[1].imgEL.src = urls[curIndex];
      buildImgUrl(boxes);
      isAutoPlay && (timerId = setTimeout(autoPlay, cycle))
    }

    function initData (options) {
      curIndex = options.curIndex;
      urls = options.urls;
      isAutoPlay = typeof options.isAutoPlay === 'boolean' ? options.isAutoPlay : true;
      cycle = typeof options.cycle === 'number' ? options.cycle : 2222;
      changeCallback = options.change || noop;
    }

    function initDom (options) {
      var fragment = document.createDocumentFragment();
      var carouselDiv = document.createElement('div');
      carouselDiv.classList.add('carousel');
      fragment.appendChild(carouselDiv);

      var main = document.createElement('main');
      main.classList.add('main');
      carouselDiv.appendChild(main);

      _buildButtons(main);
      _buildImgWrappers(main);
      _buildGuideCircles(main, options.urls.length);
      options.el.appendChild(fragment);

      function _buildButtons (main) {
        //previous
        var previous = document.createElement('div');
        previous.classList.add('previous');
        previous.addEventListener('click', onPrevious);
        var previousBtn = document.createElement('div');
        previousBtn.classList.add('previous-button');
        previous.appendChild(previousBtn);

        //next
        var next = document.createElement('div');
        next.classList.add('next');
        next.addEventListener('click', onNext);
        var nextBtn = document.createElement('div');
        nextBtn.classList.add('next-button');
        next.appendChild(nextBtn);

        main.appendChild(previous);
        main.appendChild(next);
      }

      function _buildImgWrappers (main) {
        for (var i = 1; i <= 3; i += 1) {
          var imgWrapper = document.createElement('div');
          imgWrapper.classList.add('img-wrapper');
          var img = document.createElement('img');
          imgWrapper.appendChild(img);
          main.appendChild(imgWrapper);
          boxes.push(
            {
              el: imgWrapper,
              imgEL: img
            }
          );
        }
        boxes[0].el.classList.add('left');
        boxes[1].el.classList.add('current');
        boxes[2].el.classList.add('right');
      }

      function _buildGuideCircles (main, length) {
        var guide = document.createElement('div');
        guide.classList.add('guide');
        guide.addEventListener('click', guideClickHandler);//委托
        buildIndicators(guide, length);
        initIndicators(guide);
        main.appendChild(guide);

        function buildIndicators (guide, length) {
          var frag = document.createDocumentFragment();
          for (var i = 0; i < length; i++) {
            var div = document.createElement('div');
            div.classList.add('indicator');
            div.dataset.index = i;
            frag.appendChild(div);
          }
          guide.appendChild(frag);
        }
      }
    }

    //TODO
    function guideClickHandler (e) {
      //isNullOrUndefined
      if (isMoving) {
        return;
      }
      if (typeof e.target.dataset.index === 'undefined' || (typeof e.target.dataset.index === 'object' && !e.target.dataset.index)) {
        return;
      }
      terminalPlay(jumpTo, e.target.dataset.index)
    }

    function terminalPlay (cb, arg) {
      clearTimeout(timerId);
      cb(arg);
      isAutoPlay && (timerId = setTimeout(autoPlay, cycle))
    }

    function buildImgUrl (boxes) {
      boxes[0].imgEL.src = urls[curIndex === 0 ? urls.length - 1 : curIndex - 1];
      boxes[2].imgEL.src = urls[curIndex === urls.length - 1 ? 0 : curIndex + 1];
      isMoving = false;
    }

    function onNext () {
      terminalPlay(next);
    }

    function onPrevious () {
      terminalPlay(previous);
    }


    function previous (step) {//step移动步数
      if (isMoving) {
        return;
      }
      !step && step !== 0 && (step = 1);//step不存在，默认移动1一步
      curIndex = curIndex - step;
      if (curIndex < 0) {
        curIndex += urls.length
      }
      var footer = boxes.pop();
      boxes.unshift(footer);

      move(boxes, LEFT);
    }

    function next (step) {
      if (isMoving) {
        return;
      }
      !step && step !== 0 && (step = 1);//i不存在，默认移动1一步
      curIndex = curIndex + step;
      if (curIndex >= urls.length) {
        curIndex -= urls.length
      }
      var head = boxes.shift();
      boxes.push(head);
      move(boxes, RIGHT);
    }

//跳到第几张
    function jumpTo (i) {
      if (i > curIndex) {
        next(i - curIndex);
      } else if (i < curIndex) {
        previous(curIndex - i);
      }
    }


    function move (boxes, direction) {
      isMoving = true;
      boxes[1].imgEL.src = urls[curIndex];//先渲染主图

      var leftNode = boxes[0].el;
      leftNode.style.visibility = direction === RIGHT ? 'visible' : 'hidden';
      !leftNode.classList.contains('left') && leftNode.classList.add('left');
      leftNode.classList.remove('current');
      leftNode.classList.remove('right');

      var currentNode = boxes[1].el;
      currentNode.style.visibility = 'visible';
      !currentNode.classList.contains('current') && currentNode.classList.add('current');
      currentNode.classList.remove('left');
      currentNode.classList.remove('right');

      var rightNode = boxes[2].el;
      rightNode.style.visibility = direction === LEFT ? 'visible' : 'hidden';
      !rightNode.classList.contains('right') && rightNode.classList.add('right');
      rightNode.classList.remove('left');
      rightNode.classList.remove('current');
      var guide = boxes[0].el.parentNode.querySelector('.guide');

      initIndicators(guide);
      setTimeout(buildImgUrl, 500, boxes);
      changeCallback()//
    }

    function initIndicators (guide) {
      guide.querySelectorAll('[data-index]').forEach(function (item) {
        item.style.borderColor = 'white';
      })
      guide.querySelector('[data-index="' + curIndex + '"]').style.borderColor = '#328bff';
    }

    function autoPlay () {
      if (isMoving) {
        return;
      }
      next();
      isAutoPlay && (timerId = setTimeout(autoPlay, cycle))
    }


  }

  function init (option) {
    return initCarousel(option);
  }

  return {
    init: init
  }
})()

function log () {
  console.log(Math.random());
}
//-----------------------------------------------------------------------------------------
carousel.init({
  el: document.getElementById('div1'),
  urls: ['./1.jpg', './2.jpg', './3.jpg', './4.jpg', './5.jpg'],//
  curIndex: 3,//urls数组的下标，0是第一个,
  cycle: 4444
}) ===
carousel.init({
  el: document.getElementById('div1'),
  urls: ['./6.jpg', './7.jpg', './8.jpg', './9.jpg'],//
  curIndex: 3,//urls数组的下标，0是第一个
  change:log
})
carousel.init({
  el: document.getElementById('div1'),
  urls: ['./3.jpg', './4.jpg', './5.jpg', './6.jpg'],//
  curIndex: 3,//urls数组的下标，0是第一个
  isAutoPlay: false
})
</script>